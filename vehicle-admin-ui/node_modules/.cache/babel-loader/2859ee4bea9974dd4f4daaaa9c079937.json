{"remainingRequest":"/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/node_modules/thread-loader/dist/cjs.js!/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/node_modules/babel-loader/lib/index.js!/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/node_modules/eslint-loader/index.js??ref--13-0!/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/src/router/index.js","dependencies":[{"path":"/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/src/router/index.js","mtime":1734063882630},{"path":"/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/.babelrc","mtime":1734230871032},{"path":"/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/node_modules/cache-loader/dist/cjs.js","mtime":1734234711738},{"path":"/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/node_modules/thread-loader/dist/cjs.js","mtime":1734234711278},{"path":"/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/node_modules/babel-loader/lib/index.js","mtime":1734234712752},{"path":"/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/node_modules/eslint-loader/index.js","mtime":1734234711712}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.function.name\";\nimport _toConsumableArray from \"/Users/TaoBangren/gitee/finhub-vehicle/vehicle-admin-ui/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray.js\";\nimport Vue from 'vue';\nimport iView from 'iview';\nimport Router from 'vue-router';\nimport store from '@/store';\nimport config from '@/config';\nimport { iviewAdminRouter } from \"./iviewAdmin\";\nimport { adminRouter } from \"./app\";\nimport { canTurnTo, getToken, setTitle, setToken, setMenuOptionMapInSessionstorage, getMenuOptionMapFromSessionstorage } from '@/libs/util';\nimport { oneOf } from '@/libs/tools';\nVue.use(Router);\n\n// 所有上面定义的路由都要写在下面的routes里\nexport var routes = [].concat(_toConsumableArray(adminRouter), _toConsumableArray(iviewAdminRouter));\nvar router = new Router({\n  routes: routes,\n  mode: 'hash'\n});\nvar turnTo = function turnTo(to, next, user) {\n  // 拉取用户信息，通过用户权限和跳转的页面的name来判断是否有权限访问;access必须是一个数组，如：['super_admin'] ['super_admin', 'admin']\n  if (canTurnTo(to.name, [user.access], routes)) {\n    if (config.checkUserMenu && !oneOf(to.name, config.checkUserMenuIgnoreRouters) && !store.state.loginStore.menuOptionMap[to.path]) {\n      var menuOptionMap = getMenuOptionMapFromSessionstorage();\n      if (Object.keys(menuOptionMap).length <= 0) {\n        // 有权限，继续访问\n        store.dispatch('listUserMenuOperation', {\n          params: {\n            menuPath: to.path\n          }\n        }).then(function () {\n          setMenuOptionMapInSessionstorage(store.state.loginStore.menuOptionMap);\n          next();\n        });\n      } else {\n        store.state.loginStore.menuOptionMap = menuOptionMap;\n        if (!menuOptionMap.hasOwnProperty(to.path)) {\n          // 有权限，继续访问\n          store.dispatch('listUserMenuOperation', {\n            params: {\n              menuPath: to.path\n            }\n          }).then(function () {\n            setMenuOptionMapInSessionstorage(store.state.loginStore.menuOptionMap);\n            next();\n          });\n        } else {\n          next();\n        }\n      }\n    } else {\n      next();\n    }\n  } else {\n    // 无权限，重定向到401页面\n    next({\n      replace: true,\n      name: 'error_401'\n    });\n  }\n};\nrouter.beforeEach(function (to, from, next) {\n  var token = getToken();\n  if (!token && to.name !== config.loginName) {\n    // 未登录且要跳转的页面不是登录页\n    iView.LoadingBar.start();\n    next({\n      name: config.loginName // 跳转到登录页\n    });\n  } else if (!token && to.name === config.loginName) {\n    // 未登陆且要跳转的页面是登录页\n    iView.LoadingBar.start();\n    next(); // 跳转\n  } else if (token && to.name === config.loginName) {\n    // 已登录且要跳转的页面是登录页 & 跳转到home页\n    if (from.name === config.homeName) {\n      next(false);\n    } else {\n      iView.LoadingBar.start();\n      next({\n        name: config.homeName\n      });\n    }\n  } else {\n    // 已登录且要跳转的页面不是登录页\n    if (!store.state.iviewAdminUserStore.hasGetInfo) {\n      // 刷新页面时，重新获取当前登录用户信息\n      store.dispatch('userInfo').then(function () {\n        var user = store.state.loginStore.user;\n        store.commit('setToken', user.token);\n        store.commit('setAvatar', user.avatar);\n        store.commit('setUserName', user.name);\n        store.commit('setAccess', user.access);\n        store.commit('setHasGetInfo', true);\n        turnTo(to, next, user);\n      }).catch(function () {\n        setToken('');\n        next({\n          name: 'login'\n        });\n      });\n    } else {\n      var user = store.state.loginStore.user;\n      turnTo(to, next, user);\n    }\n  }\n});\nrouter.afterEach(function (to) {\n  setTitle(to, router.app);\n  iView.LoadingBar.finish();\n  window.scrollTo(0, 0);\n});\nexport default router;",null]}